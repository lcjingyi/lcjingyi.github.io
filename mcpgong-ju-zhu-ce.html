<!DOCTYPE html>
<html lang="chinese (simplified)">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Pelican" />
    <title>MCP工具注册 | linqixu_Blog</title>

    <!-- CSS -->
    <link rel="stylesheet" href="/theme/css/main.css" />

    <!-- RSS Feeds -->

    <!-- Extra head content -->
</head>

<body id="index" class="homearticle">
    <div class="container">
        <!-- Header -->

        <!-- Main content -->
        <main id="content">
    <a href="/" class="back-button">返回首页</a>
    <article class="hentry">
        <header>
            <h1 class="entry-title">MCP工具注册</h1>
        </header>

        <footer class="post-info">
            <time class="published" datetime="2025-11-06T18:00:00+08:00">
                周四 06 十一月 2025
            </time>
            <address class="vcard author">
                By <a class="url fn" href="/author/lingqixu/">lingqixu</a>
            </address>
            <p>In <a href="/category/mcp/">MCP</a>.</p>
            <p>tags:
                <a href="/tag/mcp/">MCP</a>            </p>
        </footer>

        <div class="entry-content">
            <h1>MCP 工具注册完整指南</h1>
<h2>什么是工具注册？</h2>
<p>在 MCP (Model Context Protocol) 中，<strong>工具注册</strong>是告诉 AI 模型（如 Claude）你这个服务器能提供什么功能的过程。就像餐厅的菜单一样，注册的工具列表就是 AI 可以使用的"功能菜单"。</p>
<h2>工具注册的核心组件</h2>
<h3>1. 工具定义结构</h3>
<p>每个工具都必须包含以下核心信息：</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;工具的唯一标识符&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;工具功能的中文描述&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;inputSchema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;参数名&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;数据类型&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;参数描述&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;必需参数列表&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3>2. 代码中的注册实现</h3>
<p>在 <code>mcp_client.py</code> 中，工具注册通过 <code>_register_tools()</code> 方法实现：</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_register_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;注册可用工具&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;integer_addition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;integer_addition&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;计算两个整数的和&quot;</span><span class="p">,</span>
            <span class="s2">&quot;inputSchema&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;第一个整数&quot;</span><span class="p">},</span>
                    <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;第二个整数&quot;</span><span class="p">}</span>
                <span class="p">},</span>
                <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;integer_multiplication&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;integer_multiplication&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;计算两个整数的积&quot;</span><span class="p">,</span>
            <span class="s2">&quot;inputSchema&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;第一个整数&quot;</span><span class="p">},</span>
                    <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;第二个整数&quot;</span><span class="p">}</span>
                <span class="p">},</span>
                <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>

<h2>详细解析工具注册的各个部分</h2>
<h3>1. 工具名称 (name)</h3>
<div class="highlight"><pre><span></span><code><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;integer_addition&quot;</span>
</code></pre></div>

<p><strong>要求</strong>：
- 必须是<strong>唯一</strong>的标识符
- 使用小写字母和下划线
- 简洁明了，能表达工具功能
- 在 <code>call_tool</code> 方法中用作路由标识</p>
<p><strong>最佳实践</strong>：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ✅ 好的命名</span>
<span class="s2">&quot;weather_forecast&quot;</span>
<span class="s2">&quot;file_reader&quot;</span>
<span class="s2">&quot;database_query&quot;</span>

<span class="c1"># ❌ 避免的命名</span>
<span class="s2">&quot;tool1&quot;</span>
<span class="s2">&quot;addNumbers&quot;</span>  <span class="c1"># 使用驼峰命名</span>
<span class="s2">&quot;integer-addition-tool&quot;</span>  <span class="c1"># 过于冗长</span>
</code></pre></div>

<h3>2. 工具描述 (description)</h3>
<div class="highlight"><pre><span></span><code><span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;计算两个整数的和&quot;</span>
</code></pre></div>

<p><strong>作用</strong>：
- AI 模型根据描述理解工具用途
- 决定何时调用这个工具
- 提供用户友好的功能说明</p>
<p><strong>写作技巧</strong>：
- 使用简洁、准确的中文描述
- 说明输入和输出的关系
- 避免技术术语，用自然语言</p>
<h3>3. 输入模式 (inputSchema)</h3>
<p>这是最关键的部分，定义了工具接受的参数：</p>
<div class="highlight"><pre><span></span><code><span class="s2">&quot;inputSchema&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;第一个整数&quot;</span><span class="p">},</span>
        <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;第二个整数&quot;</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<h4>3.1 参数类型 (type)</h4>
<p>支持的常见类型：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 基本类型</span>
<span class="s2">&quot;string&quot;</span>   <span class="c1"># 文本</span>
<span class="s2">&quot;integer&quot;</span>  <span class="c1"># 整数</span>
<span class="s2">&quot;number&quot;</span>   <span class="c1"># 数字（包括小数）</span>
<span class="s2">&quot;boolean&quot;</span>  <span class="c1"># 布尔值</span>

<span class="c1"># 复合类型</span>
<span class="s2">&quot;array&quot;</span>    <span class="c1"># 数组</span>
<span class="s2">&quot;object&quot;</span>   <span class="c1"># 对象</span>
</code></pre></div>

<h4>3.2 参数定义 (properties)</h4>
<p>每个参数都需要定义：</p>
<div class="highlight"><pre><span></span><code><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span>           <span class="c1"># 参数类型</span>
    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;第一个整数&quot;</span>   <span class="c1"># 参数说明</span>
<span class="p">}</span>
</code></pre></div>

<h4>3.3 必需参数 (required)</h4>
<div class="highlight"><pre><span></span><code><span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]</span>  <span class="c1"># 这两个参数是必需的</span>
</code></pre></div>

<p><strong>可选参数</strong>：</p>
<div class="highlight"><pre><span></span><code><span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;第一个整数&quot;</span><span class="p">},</span>
    <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;第二个整数&quot;</span><span class="p">},</span>
    <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;boolean&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;是否四舍五入&quot;</span><span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]</span>  <span class="c1"># round 是可选参数</span>
</code></pre></div>

<h2>注册流程的完整过程</h2>
<h3>1. 初始化阶段</h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:8000&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 空的工具字典</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_register_tools</span><span class="p">()</span>  <span class="c1"># 注册工具</span>
</code></pre></div>

<h3>2. 注册阶段</h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_register_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># 将工具定义存储到 self.tools 字典中</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;工具名&quot;</span><span class="p">:</span> <span class="n">工具定义</span><span class="p">,</span>
        <span class="o">...</span>
    <span class="p">}</span>
</code></pre></div>

<h3>3. 查询阶段 (tools/list)</h3>
<p>当 AI 模型询问可用工具时：</p>
<div class="highlight"><pre><span></span><code><span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;tools/list&quot;</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span>
        <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;tools&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>  <span class="c1"># 返回所有注册的工具</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>

<h2>如何添加新工具</h2>
<h3>示例：添加一个除法工具</h3>
<h4>步骤 1：在 <code>_register_tools()</code> 中添加工具定义</h4>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_register_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;注册可用工具&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># 现有工具...</span>

        <span class="c1"># 新增除法工具</span>
        <span class="s2">&quot;integer_division&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;integer_division&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;计算两个整数的商&quot;</span><span class="p">,</span>
            <span class="s2">&quot;inputSchema&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;被除数&quot;</span><span class="p">},</span>
                    <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;除数&quot;</span><span class="p">}</span>
                <span class="p">},</span>
                <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>

<h4>步骤 2：实现计算逻辑</h4>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">divide_numbers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;整数除法计算&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;除数不能为零&quot;</span><span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/divide&quot;</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">b</span><span class="p">},</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;result&quot;</span><span class="p">]}</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;除法计算失败: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;除法计算错误: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
</code></pre></div>

<h4>步骤 3：在 <code>call_tool()</code> 中添加路由</h4>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">call_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;调用指定工具&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s2">&quot;integer_addition&quot;</span><span class="p">:</span>
        <span class="c1"># 现有加法逻辑...</span>

    <span class="k">elif</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s2">&quot;integer_multiplication&quot;</span><span class="p">:</span>
        <span class="c1"># 现有乘法逻辑...</span>

    <span class="k">elif</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s2">&quot;integer_division&quot;</span><span class="p">:</span>  <span class="c1"># 新增除法逻辑</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">divide_numbers</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">],</span> <span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> ÷ </span><span class="si">{</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>

    <span class="c1"># 其他现有逻辑...</span>
</code></pre></div>

<h2>高级工具注册技巧</h2>
<h3>1. 复杂参数类型</h3>
<div class="highlight"><pre><span></span><code><span class="s2">&quot;analyze_text&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;analyze_text&quot;</span><span class="p">,</span>
    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;分析文本的情感和主题&quot;</span><span class="p">,</span>
    <span class="s2">&quot;inputSchema&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;要分析的文本内容&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;sentiment&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;boolean&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;是否分析情感&quot;</span><span class="p">},</span>
                    <span class="s2">&quot;topics&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;boolean&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;是否分析主题&quot;</span><span class="p">},</span>
                    <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;文本语言&quot;</span><span class="p">}</span>
                <span class="p">},</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;分析选项&quot;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3>2. 数组参数</h3>
<div class="highlight"><pre><span></span><code><span class="s2">&quot;calculate_average&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;calculate_average&quot;</span><span class="p">,</span>
    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;计算数字列表的平均值&quot;</span><span class="p">,</span>
    <span class="s2">&quot;inputSchema&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;numbers&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;array&quot;</span><span class="p">,</span>
                <span class="s2">&quot;items&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">},</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;数字列表&quot;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;numbers&quot;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3>3. 枚举参数</h3>
<div class="highlight"><pre><span></span><code><span class="s2">&quot;format_date&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;format_date&quot;</span><span class="p">,</span>
    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;格式化日期&quot;</span><span class="p">,</span>
    <span class="s2">&quot;inputSchema&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;日期字符串&quot;</span><span class="p">},</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                <span class="s2">&quot;enum&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;YYYY-MM-DD&quot;</span><span class="p">,</span> <span class="s2">&quot;MM/DD/YYYY&quot;</span><span class="p">,</span> <span class="s2">&quot;DD-MM-YYYY&quot;</span><span class="p">],</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;输出格式&quot;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;format&quot;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2>工具注册的最佳实践</h2>
<h3>1. 命名规范</h3>
<ul>
<li>使用动词开头的描述性名称</li>
<li>小写字母和下划线</li>
<li>避免缩写，使用完整单词</li>
</ul>
<h3>2. 描述写作</h3>
<ul>
<li>清晰说明输入输出关系</li>
<li>使用自然语言，避免技术术语</li>
<li>包含使用场景说明</li>
</ul>
<h3>3. 参数设计</h3>
<ul>
<li>提供合理的默认值</li>
<li>明确区分必需和可选参数</li>
<li>使用适当的数据类型</li>
</ul>
<h3>4. 错误处理</h3>
<ul>
<li>在工具定义中描述可能的错误情况</li>
<li>提供有意义的错误消息</li>
<li>考虑边界情况</li>
</ul>
<h2>总结</h2>
<p>MCP 工具注册是一个<strong>声明式</strong>的过程：</p>
<ol>
<li><strong>定义工具</strong>：在 <code>_register_tools()</code> 中声明工具的元数据</li>
<li><strong>实现逻辑</strong>：编写具体的处理函数</li>
<li><strong>路由调用</strong>：在 <code>call_tool()</code> 中连接工具名和处理逻辑</li>
<li><strong>自动发现</strong>：AI 模型通过 <code>tools/list</code> 自动发现可用工具</li>
</ol>
<p>这种设计让工具注册变得<strong>声明式</strong>和<strong>可扩展</strong>，开发者只需要专注于工具的定义和实现，MCP 框架会处理所有的通信和路由逻辑。</p>
        </div>

        <!-- Article navigation -->
    </article>
        </main>

        <!-- Sidebar removed -->

        <!-- Footer -->
        <footer id="contentinfo" class="body">
            <!-- 页脚内容已移除 -->
        </footer>
    </div>

    <!-- Scripts -->
    <script src="/theme/js/main.js"></script>
</body>
</html>